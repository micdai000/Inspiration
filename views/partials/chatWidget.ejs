<!-- Floating Chat Button -->
<button id="chatToggle" class="chat-toggle">ðŸ’¬</button>

<!-- Chat Widget -->
<div id="chatWidget" class="chat-widget hidden">
  <div class="chat-header">
  <span>Chat with Orion</span>
  <div class="chat-controls">
    <button id="themeToggle" title="Toggle dark mode">ðŸŒ™</button>
    <button id="chatClose">âœ•</button>
  </div>
</div>


  <div class="chat-box" id="chatBox">
  <div id="suggestedQuestions" class="suggested-questions hidden">
    <button data-question="What are Michaelâ€™s strengths?">What are Michaelâ€™s strengths?</button>
    <button data-question="What projects has Michael worked on?">What projects has he worked on?</button>
    <button data-question="What does Michael enjoy in his free time?">What does Michael enjoy in his free time?</button>
    <button data-question="What is Michael looking for professionally?">What is Michael looking for professionally?</button>
  </div>
</div>


  <form id="chatForm" class="chat-form">
    <input
      id="questionInput"
      type="text"
      placeholder="Ask me about Michaelâ€¦"
      autocomplete="off"
      required
    />
    <button type="submit">Send</button>
  </form>
</div>

<script>
  let hasGreeted = false;
  const chatToggle = document.getElementById("chatToggle");
  const chatWidget = document.getElementById("chatWidget");
  const chatClose = document.getElementById("chatClose");
  const chatBox = document.getElementById("chatBox");
  const chatForm = document.getElementById("chatForm");
  const questionInput = document.getElementById("questionInput");
  const suggestedQuestions = document.getElementById("suggestedQuestions");
  const themeToggle = document.getElementById("themeToggle");



  chatToggle.addEventListener("click", () => {
  chatWidget.classList.add("open");
  chatToggle.classList.add("hidden");

  greetUser();
});



  chatClose.addEventListener("click", () => {
  chatWidget.classList.remove("open");
  chatToggle.classList.remove("hidden");
});

  function addMessage(role, text) {
    const msg = document.createElement("div");
    msg.className = role === "user" ? "msg user" : "msg bot";
    msg.textContent = text;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function greetUser() {
  if (hasGreeted) return;

  addMessage(
    "bot",
    "Hi! Iâ€™m Orion ðŸ‘‹\n\nAsk me anything about Michaelâ€™s background, projects, strengths, or interests."
  );

  suggestedQuestions.classList.remove("hidden");
  hasGreeted = true;
    }


  function sendQuestion(question) {
  addMessage("user", question);
  addMessage("bot", "Orion is thinkingâ€¦");

  suggestedQuestions.classList.add("hidden");

  fetch("/ask", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ question })
  })
    .then(res => res.json())
    .then(data => {
      chatBox.lastChild.remove();

      if (data.answer) {
        addMessage("bot", data.answer);
      } else {
        addMessage("bot", "Sorry â€” I couldnâ€™t answer that.");
      }
    })
    .catch(() => {
      chatBox.lastChild.remove();
      addMessage("bot", "Network error. Please try again.");
    });
    }

    suggestedQuestions.addEventListener("click", (e) => {
        if (e.target.tagName !== "BUTTON") return;

        const question = e.target.dataset.question;
        sendQuestion(question);
    });




  chatForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const question = questionInput.value.trim();
    if (!question) return;

    suggestedQuestions.classList.add("hidden");

    addMessage("user", question);
    questionInput.value = "";

    addMessage("bot", "Orion is thinkingâ€¦");

    try {
      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question })
      });

      const data = await res.json();

      chatBox.lastChild.remove();

      if (data.answer) {
        addMessage("bot", data.answer);
      } else {
        addMessage("bot", "Sorry â€” I couldnâ€™t answer that.");
      }
    } catch {
      chatBox.lastChild.remove();
      addMessage("bot", "Network error. Please try again.");
    }
  });

  themeToggle.addEventListener("click", () => {
  chatWidget.classList.toggle("dark");
  });

</script>
